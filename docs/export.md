<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

# nbprocess.export
- Exporting a notebook to a library
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
from fastcore.test import *
from pdb import set_trace
from importlib import reload
import shutil
```

</div>

</div>

Special comments at the start of a cell can be used to provide information to `nbprocess` about how to process a cell, so we need to be able to find the location of these comments.
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
minimal = read_nb('../tests/minimal.ipynb')
```

</div>

</div>

nbprocess comments start with `#`, followed by whitespace delimited tokens, which `extract_comments` extracts from the start of a cell, up until a blank line or a line containing something other than comments:
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
exp  = """#export module
# hide
1+2
#bar"""
test_eq(extract_comments(exp), [['export', 'module'],['hide']])
```

</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
class _PrintExample:
    def _printme_(self, nbp, to_print): print(to_print)

everything_fn = '../tests/01_everything.ipynb'
proc = NBProcessor(everything_fn, _PrintExample())
proc.process()
```

</div>
<div class="output_area" markdown="1">

    testing


</div>

</div>

Specify `dest` where the module(s) will be exported to, and optionally a class to use to create the module (`ModuleMaker`, by default).

Exported cells are stored in a `dict` called `modules`, where the keys are the modules exported to. Those without an explicit module are stored in the `'#'` key, which will be exported to `default_exp`.
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
exp = ExportModuleProc()
proc = NBProcessor(everything_fn, exp)
proc.process()
test_eq(exp.default_exp, 'everything')
assert 'print_function'  in exp.modules['#'][0].source
assert 'h_n' in exp.in_all['some.thing'][0].source
```

</div>

</div>

Let's check we can import a test file:
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
shutil.rmtree('tmp', ignore_errors=True)
create_modules('../tests/00_some.thing.ipynb', 'tmp')

g = exec_new('import tmp.some.thing')
test_eq(g['tmp'].some.thing.__all__, ['a'])
test_eq(g['tmp'].some.thing.a, 1)
```

</div>

</div>

We'll also check that our 'everything' file exports correctly:
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
create_modules(everything_fn, 'tmp')

g = exec_new('import tmp.everything; from tmp.everything import *')
_alls = L("a b d e m n o p q".split())
for s in _alls.map("{}_y"): assert s in g, s
for s in "c_y_nall _f_y_nall g_n h_n i_n j_n k_n l_n".split(): assert s not in g, s
for s in _alls.map("{}_y") + ["c_y_nall", "_f_y_nall"]: assert hasattr(g['tmp'].everything,s), s
```

</div>

</div>

That notebook should also export one extra function to `tmp.some.thing`:
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
del(sys.modules['tmp.some.thing']) # remove from module cache
g = exec_new('import tmp.some.thing')
test_eq(g['tmp'].some.thing.__all__, ['a','h_n'])
test_eq(g['tmp'].some.thing.h_n(), None)
```

</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">


```python
#skip
Path('../nbprocess/export.py').unlink(missing_ok=True)
nbs_export()

g = exec_new('import nbprocess.export')
assert hasattr(g['nbprocess'].export, 'nb_export')
```

</div>

</div>

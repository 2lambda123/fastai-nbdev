<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-clean">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<title data-rh="true">clean | nbprocess</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nbprocess.fast.ai/clean"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="clean | nbprocess"><meta data-rh="true" name="description" content="Strip notebooks from superfluous metadata"><meta data-rh="true" property="og:description" content="Strip notebooks from superfluous metadata"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nbprocess.fast.ai/clean"><link data-rh="true" rel="alternate" href="https://nbprocess.fast.ai/clean" hreflang="en"><link data-rh="true" rel="alternate" href="https://nbprocess.fast.ai/clean" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.463b2d4a.css">
<link rel="preload" href="/assets/js/runtime~main.c8a224fb.js" as="script">
<link rel="preload" href="/assets/js/main.61181c7e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">nbprocess</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fastai/nbprocess" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/read">read</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/maker">maker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/export">export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sync">sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/merge">merge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/clean">clean</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/convert">convert</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/06a_media">06a_media</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/06b_mdx">06b_mdx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">index</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">clean</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>clean</h1></header><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#default_exp clean</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from fastcore.script import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from fastcore.utils import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from fastcore.imports import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from nbprocess.imports import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from nbprocess.read import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from nbprocess.sync import *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># import io,sys,json,glob,re</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h1>Clean notebooks</h1><blockquote><p>Strip notebooks from superfluous metadata</p></blockquote><p>To avoid pointless conflicts while working with jupyter notebooks (with different execution counts or cell metadata), it is recommended to clean the notebooks before committing anything (done automatically if you install the git hooks with <code>nbdev_install_git_hooks</code>). The following functions are used to do that.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="utils">Utils<a class="hash-link" href="#utils" title="Direct link to heading">‚Äã</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _clean_cell_output(cell):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Remove execution count in `cell`&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if &#x27;outputs&#x27; in cell:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for o in cell[&#x27;outputs&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if &#x27;execution_count&#x27; in o: o[&#x27;execution_count&#x27;] = None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o.get(&#x27;data&#x27;,{}).pop(&quot;application/vnd.google.colaboratory.intrinsic+json&quot;, None)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o.get(&#x27;metadata&#x27;, {}).pop(&#x27;tags&#x27;, None)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _clean_cell(cell, clear_all=False):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Clean `cell` by removing superfluous metadata or everything except the input if `clear_all`&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if &#x27;execution_count&#x27; in cell: cell[&#x27;execution_count&#x27;] = None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if &#x27;outputs&#x27; in cell:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if clear_all: cell[&#x27;outputs&#x27;] = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:         _clean_cell_output(cell)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if cell[&#x27;source&#x27;] == [&#x27;&#x27;]: cell[&#x27;source&#x27;] = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell[&#x27;metadata&#x27;] = {} if clear_all else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        k:v for k,v in cell[&#x27;metadata&#x27;].items() if k==&quot;hide_input&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def clean_nb(nb, clear_all=False):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Clean `nb` from superfluous metadata&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for c in nb[&#x27;cells&#x27;]: _clean_cell(c, clear_all=clear_all)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nb[&#x27;metadata&#x27;] = {k:v for k,v in nb[&#x27;metadata&#x27;].items() if k in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     (&quot;kernelspec&quot;, &quot;jekyll&quot;, &quot;jupytext&quot;, &quot;doc&quot;)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tst = {&#x27;cell_type&#x27;: &#x27;code&#x27;, &#x27;execution_count&#x27;: 26,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &#x27;metadata&#x27;: {&#x27;hide_input&#x27;: True, &#x27;meta&#x27;: 23},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &#x27;outputs&#x27;: [{&#x27;execution_count&#x27;: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;data&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &#x27;application/vnd.google.colaboratory.intrinsic+json&#x27;: {&#x27;type&#x27;: &#x27;string&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &#x27;plain/text&#x27;: [&#x27;sample output&#x27;,]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }, &#x27;output&#x27;: &#x27;super&#x27;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &#x27;source&#x27;: &#x27;awesome_code&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nb = {&#x27;metadata&#x27;: {&#x27;kernelspec&#x27;: &#x27;some_spec&#x27;, &#x27;jekyll&#x27;: &#x27;some_meta&#x27;, &#x27;meta&#x27;: 37}, &#x27;cells&#x27;: [tst]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean_nb(nb)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_eq(nb[&#x27;cells&#x27;][0], {&#x27;cell_type&#x27;: &#x27;code&#x27;, &#x27;execution_count&#x27;: None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &#x27;metadata&#x27;: {&#x27;hide_input&#x27;: True},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &#x27;outputs&#x27;: [{&#x27;execution_count&#x27;: None, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           &#x27;data&#x27;: { &#x27;plain/text&#x27;: [&#x27;sample output&#x27;,]},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           &#x27;output&#x27;: &#x27;super&#x27;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &#x27;source&#x27;: &#x27;awesome_code&#x27;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_eq(nb[&#x27;metadata&#x27;], {&#x27;kernelspec&#x27;: &#x27;some_spec&#x27;, &#x27;jekyll&#x27;: &#x27;some_meta&#x27;})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="main-function">Main function<a class="hash-link" href="#main-function" title="Direct link to heading">‚Äã</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _wrapio(strm): return io.TextIOWrapper(strm, encoding=&#x27;utf-8&#x27;, line_buffering=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _clean_write(nb, f_in, f_out=None, clear_all=False):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not f_out: f_out = f_in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nb = json.load(f_in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clean_nb(nb, clear_all=clear_all)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    write_nb(nb, f_out)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@call_parse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def nbdev_clean_nbs(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fname:str=None, # A notebook name or glob to convert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clear_all:bool_arg=False, # Clean all metadata and outputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_stdin:bool_arg=False # Read input stream and not nb folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Clean all notebooks in `fname` to avoid merge conflicts&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Git hooks will pass the notebooks in stdin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if read_stdin: return _clean_write(nb, _wrapio(sys.stdin), _wrapio(sys.stdout), clear_all=clear_all)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if fname is None: fname = get_config().path(&quot;nbs_path&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for f in globtastic(fname, file_glob=&#x27;*.ipynb&#x27;, skip_folder_re=&#x27;^[_.]&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _clean_write(nb, f, clear_all=clear_all)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>By default (<code>fname</code> left to <code>None</code>), the all the notebooks in <code>lib_folder</code> are cleaned. You can opt in to fully clean the notebook by removing every bit of metadata and the cell outputs by passing <code>clear_all=True</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="export--">Export -<a class="hash-link" href="#export--" title="Direct link to heading">‚Äã</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#hide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from nbprocess.export import nbs_export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nbs_export()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/fastai/nbprocess/tree/main/packages/create-docusaurus/templates/shared/docs/05_clean.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/merge"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">merge</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/convert"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">convert</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#utils" class="table-of-contents__link toc-highlight">Utils</a></li><li><a href="#main-function" class="table-of-contents__link toc-highlight">Main function</a></li><li><a href="#export--" class="table-of-contents__link toc-highlight">Export -</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 fastai, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c8a224fb.js"></script>
<script src="/assets/js/main.61181c7e.js"></script>
</body>
</html>